<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>UrbanMood - Entrenadores</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { background:#0d0d0d;color:#e5e7e8;font-family:'Poppins',sans-serif;margin:0;padding-left:236px;transition:none; }
    .admin-content { opacity:0; animation:fadeIn 0.3s ease-out forwards; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
    .admin-sidebar { position:fixed; top:0; left:0; height:100vh; width:236px; background:#101010; border-right:1px solid #1f1f1f; padding:18px 14px; font-family:'Poppins',sans-serif; z-index:1200; display:flex; flex-direction:column; gap:14px; overflow:hidden; box-sizing:border-box; }
    .admin-sidebar .admin-brand { margin:0 0 10px; background:#3d4348; padding:6px 6px 4px; border-radius:4px; }
    .admin-sidebar nav ul { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:4px; }
    .admin-sidebar nav a { display:flex; align-items:center; gap:10px; padding:8px 10px; color:#c9ced2; font-size:.75rem; font-weight:600; text-decoration:none; border-radius:8px; transition:background .15s ease, color .15s ease; }
    .admin-sidebar nav a:hover { background:#1d1d1d; color:#e8eaec; }
    .admin-sidebar nav a.active { background:#1f1f1f; color:#c2d03a; border:1px solid #2d2d2d; }
    .admin-sidebar nav a i { width:16px; text-align:center; font-size:.9rem; }
    .admin-sidebar nav li.sep { margin:6px 0; border-top:1px solid #242424; }
    main { padding:46px 52px 80px; }
    h1 { margin:0 0 26px;font-size:2rem;color:#c2d03a; }
    .stats { display:flex; gap:16px; margin-bottom:28px; flex-wrap:wrap; }
    .stat-card { background:#121212; border:1px solid #262626; border-radius:14px; padding:18px 22px; min-width:160px; }
    .stat-card .value { font-size:1.8rem; font-weight:700; color:#c2d03a; }
    .stat-card .label { font-size:.65rem; color:#8a9096; text-transform:uppercase; letter-spacing:.5px; margin-top:4px; }
    .section-title { font-size:1rem; color:#c2d03a; margin:30px 0 16px; display:flex; align-items:center; gap:8px; }
    table { width:100%;border-collapse:collapse;background:#121212;border:1px solid #262626;border-radius:12px;overflow:hidden; }
    th,td { padding:10px 14px;font-size:.85rem;text-align:left; }
    th { background:#181818;font-weight:600;letter-spacing:.05em;text-transform:uppercase;font-size:.7rem;color:#9ba1a6; }
    tbody tr { border-top:1px solid #1f1f1f; }
    tbody tr:hover { background:#1b1b1b; }
    .status-badge { padding:2px 8px;border-radius:999px;font-size:.6rem;font-weight:600;letter-spacing:.05em; }
    .status-badge.active { background:#1f3c1f;color:#7edc7e; }
    .status-badge.inactive { background:#402020;color:#ff8d8d; }
    .icon-btn { background:#1c1c1c;border:1px solid #2c2c2c;color:#c2d03a;padding:4px 8px;border-radius:6px;font-size:.65rem;font-weight:600;cursor:pointer;margin-right:4px; }
    .icon-btn.danger { color:#ff7b7b; }
    .icon-btn:hover { background:#252525; }
    .promote-section { background:#121212; border:1px solid #262626; border-radius:14px; padding:20px; margin-top:30px; }
    .promote-section h3 { margin:0 0 14px; font-size:.9rem; color:#c2d03a; }
    .promote-form { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .promote-form select { background:#181818; border:1px solid #303030; color:#eee; padding:8px 12px; border-radius:8px; font-size:.8rem; min-width:250px; }
    .promote-form button { background:#c2d03a; color:#111; border:none; padding:8px 16px; border-radius:8px; font-weight:600; cursor:pointer; font-size:.75rem; }
    .promote-form button:hover { filter:brightness(1.05); }
    .empty { text-align:center;opacity:.6;padding:50px 10px;border:2px dashed #222;border-radius:18px;font-size:.8rem; }
    #msg { font-size:.75rem; margin-top:8px; min-height:16px; }
    @media (max-width:860px){ body { padding-left:0!important; } main { padding:24px 16px 60px; } }
  </style>
</head>
<body>
{% include '_admin_sidebar.html' %}
<main class="admin-content">
  <h1>Entrenadores</h1>

  <div class="stats">
    <div class="stat-card">
      <div class="value">{{ coaches|length }}</div>
      <div class="label">Total Coaches</div>
    </div>
    <div class="stat-card">
      <div class="value">{{ total_rutinas }}</div>
      <div class="label">Rutinas Creadas</div>
    </div>
  </div>

  <h3 class="section-title"><i class="fas fa-user-tie"></i> Coaches Actuales</h3>

  {% if not coaches %}
  <div class="empty">
    <i class="fas fa-user-tie" style="font-size:2.5rem;margin-bottom:12px;opacity:.4;"></i><br>
    No hay entrenadores registrados.
  </div>
  {% else %}
  <table>
    <thead>
      <tr><th>Nombre</th><th>Email</th><th>Estado</th><th>Rutinas Creadas</th><th>Usuarios Asignados</th><th>Acciones</th></tr>
    </thead>
    <tbody>
      {% for c in coaches %}
      <tr data-id="{{ c.id }}">
        <td><a href="/admin/users/{{ c.id }}" style="color:#c2d03a;text-decoration:none;">{{ c.name }}</a></td>
        <td>{{ c.email }}</td>
        <td><span class="status-badge {{ 'active' if c.is_active else 'inactive' }}">{{ 'Activo' if c.is_active else 'Inactivo' }}</span></td>
        <td>{{ c.rutinas_count }}</td>
        <td>{{ c.users_count }}</td>
        <td>
          <button class="icon-btn danger demote" data-id="{{ c.id }}"><i class="fas fa-arrow-down"></i> Quitar Coach</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  <div class="promote-section">
    <h3><i class="fas fa-arrow-up"></i> Promover Usuario a Coach</h3>
    <form class="promote-form" id="promote-form">
      <select name="user_id" required>
        <option value="">Seleccionar usuario...</option>
        {% for u in regular_users %}
        <option value="{{ u.id }}">{{ u.name }} - {{ u.email }}</option>
        {% endfor %}
      </select>
      <button type="submit">Promover a Coach</button>
    </form>
    <div id="msg"></div>
  </div>
</main>

<script>
const msg = document.getElementById('msg');
function showMsg(text, ok) {
  msg.textContent = text;
  msg.style.color = ok ? '#7edc7e' : '#ff7b7b';
}

// Promote
document.getElementById('promote-form').addEventListener('submit', async e => {
  e.preventDefault();
  const userId = e.target.user_id.value;
  if(!userId) return;
  const res = await fetch(`/admin/entrenadores/${userId}/promote`, {method:'POST'});
  const j = await res.json();
  if(j.success) location.reload();
  else showMsg(j.message || 'Error', false);
});

// Demote
document.querySelectorAll('.demote').forEach(btn => {
  btn.addEventListener('click', async () => {
    if(!confirm('Â¿Quitar rol de coach a este usuario?')) return;
    const userId = btn.dataset.id;
    const res = await fetch(`/admin/entrenadores/${userId}/demote`, {method:'POST'});
    const j = await res.json();
    if(j.success) location.reload();
    else showMsg(j.message || 'Error', false);
  });
});
</script>
</body>
</html>
